---
layout: post
title: 电信NB物联网平台多个消息的使用
categories: IoT
description: 在编解码插件编写的时候，电信物联网平台多个消息的使用
keywords: NB-IoT,物联网,电信,编解码
---

> 原创
> 
> 转载请注明出处，侵权必究。

# 1、多个消息的介绍
问题：在编解码插件编写的时候，可以实现多个消息。那么多个消息有什么用呢？难道是依次发送？

依次发送，这是一个功能。另外一个功能是可以根据需求发送不同的消息。

## 1.1 依次发送的功能
比如一个数据拆分成了多个数据，那么可以建立多个消息。然后再在消息的最前面加上“地址域（messageID）”。

<img src="/images/posts/2018-5-7-Several-Messages/messageid.png" width="300" alt="编解码插件中的messageid" />

<img src="/images/posts/2018-5-7-Several-Messages/messageid_edit.png" width="400" alt="编解码插件中的messageid编辑" />

## 1.2 发送不同的消息
比如一个烟感报警器，有发送温度和烟雾等级的功能。我们可以建立两个消息，一个用于发送温度和烟雾等级，然后在最前面加上地址域（0x01）；一个用于只发送温度，最前面加地址域（0x00）。两个地址域不能相同，用于区分不同的消息。

<img src="/images/posts/2018-5-7-Several-Messages/message_2.png" width="600" alt="两个消息" />

# 2、多消息的使用

在编解码插件编写完成后，部署，注册设备。我们再来进行测试。

我用NB模拟设备发送数据"0100E8"，可以得到"Level": 0, "Temp": -24。数据中的前两个数字01表示地址域，中间两个数字表示Level，后面两个数字表示温度。

**注**：怎么出现负？我们这里设置的是int8有符号型的数字。那么最高位用于表示正或者负。比如-24，用二进制表示为10011000b。不过在计算机中用补码表示数字，所以还需要将该原码转化为补码，即除了最高位，取反加1。比如10011000b的补码是11101000b，即E8H。

再用NB模拟设备发送数据"0003"。数据中的前两个数字00表示地址域，后面两个数字表示温度。

在平台上的显示结果：

<img src="/images/posts/2018-5-7-Several-Messages/display.png" width="700" alt="平台显示结果" />


